# @perimetre/ui

A React component library with composable, brand-aware theming built on Tailwind CSS v4 and Radix UI primitives.

## Features

- **Visual Polymorphism** — Same components render different visual styles per brand
- **Design Token Architecture** — Three-tier token system (primitives, semantic, component) following Radix's 12-step color scale
- **RSC Compatible** — Module-level brand registry works in both Server and Client Components
- **CVA Composition** — Brand variants use CVA (Class Variance Authority) with tailwind-merge
- **Tailwind CSS v4** — Source-level integration with consumer's Tailwind (recommended) or pre-built CSS
- **Radix UI Primitives** — Accessible, unstyled primitives as the foundation

## Installation

```bash
pnpm add @perimetre/ui
```

## Quick Start

There are two ways to consume `@perimetre/ui` styles:

| Approach                               | Best for                       | CSS output                               |
| -------------------------------------- | ------------------------------ | ---------------------------------------- |
| **Tailwind integration** (recommended) | Projects using Tailwind CSS v4 | Single Tailwind instance, no duplication |
| **Pre-built CSS**                      | Projects without Tailwind      | Self-contained bundle (~15KB gzipped)    |

### Option A: Tailwind Integration (Recommended)

For projects that already use Tailwind CSS v4. Your project's single Tailwind instance processes PUI's source-level tokens, utilities, and variants — no duplicate CSS.

#### 1. Set up your CSS entry point

```css
/* globals.css */

/* 1. Your Tailwind instance */
@import 'tailwindcss';

/* 2. PUI integration: tokens, utilities, variants, plugins */
@import '@perimetre/ui/tailwind';

/* 3. Brand tokens (choose one) */
@import '@perimetre/ui/tailwind/sprig.css';
/* OR @import '@perimetre/ui/tailwind/acorn.css'; */
/* OR @import '@perimetre/ui/tailwind/stelpro.css'; */

/* 4. Source scanning — lets Tailwind see PUI component class names */
@source '../../node_modules/@perimetre/ui/dist/es';

/* 5. Your project-specific theme extensions */
@theme inline {
  --font-sans: 'Your Font', ui-sans-serif, system-ui, sans-serif;
  --breakpoint-tablet: 48rem;
  /* ... */
}
```

#### What `@perimetre/ui/tailwind` provides

- **CSS layers** — `pui.primitive`, `pui.semantic`, `pui.theme` for cascade control
- **Theme bridge** — `@theme inline` registering all PUI tokens as Tailwind utilities (`bg-pui-primary-9`, `text-pui-fg-default`, etc.)
- **Typography utilities** — `typo-heading-1` through `typo-extra-tiny` via `@utility`
- **Brand variants** — `pui-acorn:`, `pui-sprig:`, `pui-stelpro:` via `@custom-variant`
- **PUI namespace** — `@custom-variant pui` so PUI component class names (`pui:flex`, `pui:bg-pui-primary-9`) are generated by your Tailwind
- **Animations** — `tw-animate-css`
- **Plugins** — `@tailwindcss/typography`, `@tailwindcss/forms` (class strategy)

#### What `@perimetre/ui/tailwind/sprig.css` provides

Brand-specific design tokens (CSS custom properties) for the Sprig brand, layered on top of the Acorn base. Each brand file imports `acorn/styles.css` + its own overrides.

#### Using PUI tokens in your project

PUI tokens are available as CSS custom properties on any element under `[data-pui-brand]`. Use them via Tailwind utilities:

```html
<!-- PUI semantic tokens (recommended) -->
<p class="text-pui-fg-default bg-pui-surface-primary">...</p>
<button class="bg-pui-button-primary-fill text-pui-interactive-on-primary">...</button>

<!-- PUI primitive scales (for brand-specific values not covered by semantics) -->
<div class="bg-pui-primary-9 text-pui-overlay-1">...</div>

<!-- PUI typography utilities -->
<h1 class="typo-heading-1">...</h1>
<p class="typo-base">...</p>
<small class="typo-tiny">...</small>

<!-- Brand-conditional styles -->
<div class="pui-sprig:rounded-none pui-acorn:rounded-full">...</div>
```

Or reference tokens directly in CSS:

```css
.my-component {
  color: var(--pui-color-fg-default);
  border-color: var(--pui-color-border-rule-primary);
  box-shadow: var(--pui-shadow-card);
}
```

#### Important: `data-pui-brand` placement

PUI tokens are CSS custom properties scoped to `[data-pui-brand]`. Place this attribute on `<body>` or whatever element wraps your branded content. Elements outside this scope won't have access to PUI tokens.

```tsx
<body data-pui-brand="sprig">{/* PUI tokens available here */}</body>
```

If you reference PUI token vars (like `var(--pui-color-fg-body)`) in base styles, apply them on or inside the `[data-pui-brand]` element — not on `:root` / `<html>`:

```css
/* PUI tokens don't exist on :root — only on [data-pui-brand] and descendants */
body {
  @apply text-pui-fg-body typo-base font-sans;
}
```

### Option B: Pre-built CSS

For projects that don't use Tailwind CSS. Each brand file is self-contained with its own Tailwind runtime and all PUI utilities.

```tsx
// Import ONE brand CSS file in your app's entry point
import '@perimetre/ui/styles/sprig.css';

// Optional: CSS reset (only if your app doesn't already have one)
import '@perimetre/ui/styles/preflight.css';
```

> **Note:** The pre-built CSS includes its own Tailwind instance with a `pui:` prefix to avoid conflicts with your app's styles. If your project also uses Tailwind CSS, use **Option A** instead to avoid duplicate Tailwind output.

### Initialize the Brand

Set the active brand at module load time. In Next.js App Router, server and client bundles are separate, so initialize in both:

**Client-side initializer:**

```tsx
// src/components/BrandInitializer.tsx
'use client';

import { setActiveBrand } from '@perimetre/ui';

setActiveBrand('sprig');

export default function BrandInitializer() {
  return null;
}
```

**Root layout:**

```tsx
// app/layout.tsx
import { setActiveBrand } from '@perimetre/ui';
import BrandInitializer from '@/components/BrandInitializer';

setActiveBrand('sprig');

export default function RootLayout({ children }) {
  return (
    <html>
      <body data-pui-brand="sprig">
        <BrandInitializer />
        {children}
      </body>
    </html>
  );
}
```

All three must agree: server-side `setActiveBrand()`, client-side `setActiveBrand()`, and the `data-pui-brand` attribute.

## Design Token Architecture

Three-tier token system following [Radix's 12-step color scale](https://www.radix-ui.com/colors/docs/palette-composition/understanding-the-scale). See [Design Token Guide](./docs/design-token-guide.md) for full documentation.

### Token Tiers

1. **Primitives** (`--pui-primitive-*`) — Raw values named by what they ARE, not what they're FOR. Color scales follow Radix 12-step: steps 1-2 backgrounds, 3-5 component backgrounds, 6-8 borders, 9-10 solid/accent, 11-12 text.
2. **Semantic** (`--pui-color-*`, `--pui-typo-*`, etc.) — Purpose-based tokens that reference primitives. Components consume these.
3. **Component** — Optional component-specific overrides when semantics aren't sufficient.

### Tailwind Bridge

PUI tokens are bridged to Tailwind via `@theme inline` in `tailwind.css`:

```
CSS custom property          → Tailwind utility class
--color-pui-primary-9        → bg-pui-primary-9, text-pui-primary-9
--color-pui-fg-default       → text-pui-fg-default
--color-pui-button-hover     → bg-pui-button-hover
--shadow-pui-card            → shadow-pui-card
--ease-pui-out-cubic         → ease-pui-out-cubic
```

### CSS Layers

```css
@layer pui.primitive; /* Raw color scales, font stacks */
@layer pui.semantic; /* Purpose-based tokens referencing primitives */
@layer pui.theme; /* Tailwind theme bridge, base styles */
```

### Brand-Specific Overrides

Each brand only defines values that DIFFER from the Acorn base. Sprig overrides ~30 tokens; everything else is inherited:

```css
/* brands/sprig/styles.css — only differences from Acorn */
@layer pui.semantic {
  [data-pui-brand='sprig'] {
    --pui-color-button-primary-fill: var(--pui-primitive-color-overlay-11);
    --pui-color-button-hover: var(--pui-primitive-color-primary-9);
    --pui-color-focus-outline: var(--pui-primitive-color-primary-9);
    /* ... only what differs */
  }
}
```

## Exports

Import exactly what you need for optimal tree-shaking:

```typescript
// Brand initialization
import { setActiveBrand } from '@perimetre/ui';
import { getActiveBrand, getBrandVariant, BRANDS } from '@perimetre/ui';

// Components (tree-shakeable)
import Button from '@perimetre/ui/components/Button';
import { FieldInput } from '@perimetre/ui/components/Field/FieldInput';

// Tailwind integration (source-level, recommended)
// Used via @import in CSS — see Quick Start above

// Pre-built CSS (alternative)
import '@perimetre/ui/styles/acorn.css';
import '@perimetre/ui/styles/sprig.css';
import '@perimetre/ui/styles/stelpro.css';
import '@perimetre/ui/styles/preflight.css'; // CSS reset, only if needed
```

## Development

### Prerequisites

- Node.js 18+
- pnpm

### Commands

```bash
pnpm dev        # Start Ladle dev server
pnpm build      # Build the library
pnpm typecheck  # Type check
```

## Peer Dependencies

- `react` >= 19.0
- `react-dom` >= 19.0

## Related Packages

- `@perimetre/classnames` — Utility combining clsx and tailwind-merge
- `@perimetre/icons` — Accessible React icon wrapper
